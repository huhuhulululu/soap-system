# Plan 06-01: Adaptive Timeout Constants

**Phase:** 06 - Adaptive Timeouts
**Scope:** Replace all hardcoded timeouts with named constants from a single TIMEOUTS object

## Goal Sentence

Every timeout in `mdland-automation.ts` references a named constant from a single `TIMEOUTS` object, scaled by an optional `TIMEOUT_MULTIPLIER` env var, eliminating the global 30s default.

## Tasks

### Task 1: Add TIMEOUTS constant object and MULTIPLIER

**File:** `scripts/playwright/mdland-automation.ts`
**Action:** Modify (insert block near top, after SELECTORS)
**What:**
- Add `MULTIPLIER` const reading `process.env.TIMEOUT_MULTIPLIER` (default 1.0, fallback to 1 on NaN)
- Add `TIMEOUTS` const object with all named timeout values, each multiplied by `MULTIPLIER`:
  - **Wait timeouts:** `NAV_PAGE` (15000), `TINYMCE` (20000), `IFRAME_LOAD` (15000), `ELEMENT_WAIT` (10000)
  - **Settle timeouts:** `SETTLE_SLOW` (3000), `SETTLE_MEDIUM` (2000), `SETTLE_SORT` (1500), `SETTLE_FAST` (1000), `SETTLE_QUICK` (500), `SETTLE_MICRO` (200)
- Remove `timeout` field from `AutomationOptions` interface (L94)
- Remove `timeout: 30000` from `DEFAULT_OPTIONS` (L110)
- In `init()`, change `this.page.setDefaultTimeout(this.options.timeout)` to `this.page.setDefaultTimeout(TIMEOUTS.NAV_PAGE)`
**Lines affected:** ~L87-192 (interface, defaults, init, new const block after L151)

### Task 2: Replace all 29 inline timeout values with named constants

**File:** `scripts/playwright/mdland-automation.ts`
**Action:** Modify (find-and-replace each hardcoded timeout)
**What:** Replace every inline timeout number with the corresponding `TIMEOUTS.*` constant. Full mapping:

| Method | Line | Old Value | New Constant |
|--------|------|-----------|--------------|
| `validateSession` | 222 | `timeout: 15000` | `TIMEOUTS.NAV_PAGE` |
| `validateSession` | 226 | `waitForTimeout(3000)` | `TIMEOUTS.SETTLE_SLOW` |
| `validateSession` | 251 | `timeout: 10000` | `TIMEOUTS.ELEMENT_WAIT` |
| `clickWaitingRoom` | 291 | `timeout: 10000` | `TIMEOUTS.ELEMENT_WAIT` |
| `clickWaitingRoom` | 293 | `waitForTimeout(1000)` | `TIMEOUTS.SETTLE_FAST` |
| `clickOnePatient` | 331 | `waitForTimeout(500)` | `TIMEOUTS.SETTLE_QUICK` |
| `searchPatient` | 347 | `waitForTimeout(200)` | `TIMEOUTS.SETTLE_MICRO` |
| `searchPatient` | 355 | `timeout: 10000` | `TIMEOUTS.ELEMENT_WAIT` |
| `searchPatient` | 359 | `waitForTimeout(500)` | `TIMEOUTS.SETTLE_QUICK` |
| `selectPatient` | 395 | `waitForTimeout(2000)` | `TIMEOUTS.SETTLE_MEDIUM` |
| `sortByApptTime` | 425 | `waitForTimeout(1500)` | `TIMEOUTS.SETTLE_SORT` |
| `openVisit` | 530 | `timeout: 15000` | `TIMEOUTS.IFRAME_LOAD` |
| `openVisit` | 532 | `waitForTimeout(2000)` | `TIMEOUTS.SETTLE_MEDIUM` |
| `navigateToICD` | 562 | `timeout: 15000` | `TIMEOUTS.IFRAME_LOAD` |
| `navigateToICD` | 564 | `waitForTimeout(1000)` | `TIMEOUTS.SETTLE_FAST` |
| `addICDCodes` | 610 | `waitForTimeout(500)` | `TIMEOUTS.SETTLE_QUICK` |
| `addCPTCodes` | 687 | `waitForTimeout(500)` | `TIMEOUTS.SETTLE_QUICK` |
| `saveDiagnose` | 711 | `waitForTimeout(2000)` | `TIMEOUTS.SETTLE_MEDIUM` |
| `saveDiagnose` | 718 | `timeout: 15000` | `TIMEOUTS.IFRAME_LOAD` |
| `navigateToPTNote` | 752 | `timeout: 20000` | `TIMEOUTS.TINYMCE` |
| `navigateToPTNote` | 754 | `waitForTimeout(1000)` | `TIMEOUTS.SETTLE_FAST` |
| `saveSOAP` | 857 | `waitForTimeout(3000)` | `TIMEOUTS.SETTLE_SLOW` |
| `saveSOAP` | 864 | `timeout: 15000` | `TIMEOUTS.IFRAME_LOAD` |
| `navigateToCheckout` | 890 | `timeout: 15000` | `TIMEOUTS.IFRAME_LOAD` |
| `navigateToCheckout` | 892 | `waitForTimeout(1000)` | `TIMEOUTS.SETTLE_FAST` |
| `generateBilling` | 941 | `waitForTimeout(3000)` | `TIMEOUTS.SETTLE_SLOW` |
| `closeVisit` | 973 | `timeout: 10000` | `TIMEOUTS.ELEMENT_WAIT` |
| `closeVisit` | 976 | `waitForTimeout(1000)` | `TIMEOUTS.SETTLE_FAST` |

No logic changes — purely mechanical substitution of numbers with named constants.

**Lines affected:** 29 lines across 11 methods

## Verification

1. `npx tsc --noEmit` — zero type errors (confirms `timeout` field removal doesn't break anything)
2. `grep -n 'timeout.*[0-9]\{3,\}' scripts/playwright/mdland-automation.ts` — returns zero matches (no hardcoded timeout numbers remain)
3. `grep -c 'TIMEOUTS\.' scripts/playwright/mdland-automation.ts` — returns 29+ (all usages reference named constants)
4. `grep 'TIMEOUT_MULTIPLIER' scripts/playwright/mdland-automation.ts` — confirms env var support exists

## Risks

- **Over-tight timeouts on slow MDLand days:** Mitigated by `TIMEOUT_MULTIPLIER` env var. Operator sets `TIMEOUT_MULTIPLIER=1.5` without code changes.
- **TinyMCE 20s may be tight:** Kept at 20s per current working value. Phase 7 retry handles transient timeout failures.
- **Removing `timeout` from `AutomationOptions`:** Constructor callers no longer pass `timeout`. The CLI entry point (`main()`) does not pass it, so no breakage. Verify with `tsc`.
