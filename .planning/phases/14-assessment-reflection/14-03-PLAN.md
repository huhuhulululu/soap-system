# Phase 14, Plan 03: Snapshot Regeneration + Parity Verification

**Phase:** 14 — Assessment Reflection
**Requirements:** ASS-01, ASS-02, ASS-03 (verification)
**Scope:** Snapshot files only — no code changes
**Depends on:** 14-01, 14-02

## Goal

Regenerate the 30 fixture snapshots and verify 9 parity tests still pass after assessment text changes. Same pattern as 13-03.

## Pre-Conditions

- [ ] 14-01 and 14-02 complete
- [ ] derive-assessment unit tests pass
- [ ] assessment-cumulative integration tests pass

## Steps

### Step 1: Delete existing snapshots

```bash
rm src/generator/__fixtures__/__snapshots__/fixture-snapshots.test.ts.snap
```

### Step 2: Regenerate fixture snapshots

```bash
npx vitest run src/generator/__fixtures__/fixture-snapshots.test.ts --update
```

Should create new .snap file with updated assessment text.

### Step 3: Verify 30 snapshots pass

```bash
npx vitest run src/generator/__fixtures__/fixture-snapshots.test.ts
```

All 30 must pass.

### Step 4: Run parity diff tests

```bash
npx vitest run src/generator/__fixtures__/parity-diff.test.ts
```

If parity tests fail because assessment text changed (expected), update parity snapshots:

```bash
npx vitest run src/generator/__fixtures__/parity-diff.test.ts --update
```

Then re-run to confirm pass.

### Step 5: Spot-check assessment text quality

Manually inspect 3 snapshots (early, mid, late visit) to verify:
- [ ] Early visits use "slight improvement" / "slightly decreased"
- [ ] Late visits with cumulative evidence use "improvement" / "decreased"
- [ ] `whatChanged` varies across visits (not all "pain")
- [ ] All text comes from valid template options (ASS-03)

```bash
# Check a few assessment lines
grep -A2 "^Assessment" src/generator/__fixtures__/__snapshots__/fixture-snapshots.test.ts.snap | head -30
```

### Step 6: Run full test suite

```bash
npx vitest run
```

All tests must pass.

### Step 7: Verify only expected files changed

```bash
git diff --stat
```

Expected changes:
- `tx-sequence-engine.ts` — deriveAssessmentFromSOA enrichment + loop wiring
- `fixture-snapshots.test.ts.snap` — regenerated
- New test files: `derive-assessment.test.ts`, `assessment-cumulative.test.ts`
- Possibly parity snapshot if parity output changed

No other files should be modified.

## Post-Conditions

- [ ] 30 fixture snapshots pass
- [ ] 9 parity tests pass
- [ ] derive-assessment unit tests pass
- [ ] assessment-cumulative integration tests pass
- [ ] Full test suite green
- [ ] Assessment text shows evidence-based variation (ASS-01)
- [ ] Late visits use stronger language than early visits (ASS-02)
- [ ] All assessment text from template options (ASS-03)

## Estimated Duration

~5 minutes
