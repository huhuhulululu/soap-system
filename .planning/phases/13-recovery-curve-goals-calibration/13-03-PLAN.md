---
phase: 13-recovery-curve-goals-calibration
plan: 03
type: execute
wave: 2
depends_on: [13-01, 13-02]
files_modified:
  - src/generator/__fixtures__/fixture-snapshots.test.ts
autonomous: true
requirements: [CRV-01, CRV-02]

must_haves:
  truths:
    - "All 30 fixture snapshots regenerated in a single atomic pass after engine+goals changes"
    - "All 30 fixture snapshot tests pass with updated baselines"
    - "All 9 parity diff tests still pass (seeds 200001-200009)"
    - "Chronic fixtures (txCount ≥ 16) show slower progression and conservative LT goals in snapshot text"
  artifacts:
    - path: "src/generator/__fixtures__/fixture-snapshots.test.ts"
      provides: "30 passing snapshot tests with updated baselines"
  key_links:
    - from: "src/generator/__fixtures__/fixture-snapshots.test.ts"
      to: "src/generator/tx-sequence-engine.ts"
      via: "exportTXSeriesAsText calls engine with chronic dampener active"
      pattern: "toMatchSnapshot"
    - from: "src/generator/__fixtures__/fixture-snapshots.test.ts"
      to: "src/generator/goals-calculator.ts"
      via: "IE generation uses chronic-aware goals via soap-generator"
      pattern: "exportTXSeriesAsText"
---

<objective>
Regenerate all 30 fixture snapshots and verify parity tests after engine+goals chronic-aware changes.

Purpose: Atomic snapshot update ensures clean git diff and confirms both CRV-01 (curve) and CRV-02 (goals) are reflected in regression baselines.
Output: 30 passing snapshot tests, 9 passing parity tests, single commit.
</objective>

<execution_context>
@/Users/ping/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ping/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-recovery-curve-goals-calibration/13-RESEARCH.md
@.planning/phases/13-recovery-curve-goals-calibration/13-01-SUMMARY.md
@.planning/phases/13-recovery-curve-goals-calibration/13-02-SUMMARY.md
@src/generator/__fixtures__/fixture-snapshots.test.ts
@src/generator/__fixtures__/fixture-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Regenerate snapshots and verify parity</name>
  <files>src/generator/__fixtures__/fixture-snapshots.test.ts</files>
  <action>
**Step 1 — Confirm current snapshots fail (expected):**
Run `npx vitest run src/generator/__fixtures__/fixture-snapshots.test.ts` — expect failures because engine output changed.

**Step 2 — Regenerate all 30 snapshots in one pass:**
Run `npx vitest run src/generator/__fixtures__/fixture-snapshots.test.ts --update`

This updates the `.snap` file with new baselines reflecting chronic dampener + goals caps.

**Step 3 — Verify regenerated snapshots pass:**
Run `npx vitest run src/generator/__fixtures__/fixture-snapshots.test.ts` — all 30 must pass.

**Step 4 — Verify parity tests still pass:**
Run `npx vitest run src/generator/__fixtures__/parity-diff.test.ts` — all 9 must pass. Parity tests use seeds 200001-200009 and verify batch/compose produce identical output. The chronic changes affect both paths equally (same engine, same goals calculator), so parity should hold.

**Step 5 — Spot-check chronic fixtures for clinical plausibility:**
Identify fixtures with txCount ≥ 16 from fixture-data.ts. For those fixtures, inspect the regenerated snapshot text:
- Late visits (visit 15-20) should show pain values NOT dropping below the chronic LT target (~4-5 for pain 8)
- Progress should be spread more evenly across visits (not front-loaded)
- If any fixture shows pain dropping to 2-3 at late visits, the chronic dampener or ltFallback may not be working — flag for investigation

**Step 6 — Run full test suite:**
Run `npx vitest run` to confirm no regressions anywhere.

Do NOT modify the test file itself or fixture-data.ts. Only the .snap file should change.
  </action>
  <verify>`npx vitest run src/generator/__fixtures__/fixture-snapshots.test.ts` — 30/30 pass. `npx vitest run src/generator/__fixtures__/parity-diff.test.ts` — 9/9 pass. `npx vitest run` — full suite green.</verify>
  <done>30 fixture snapshots regenerated and passing. 9 parity tests passing. Full test suite green. Single atomic snapshot update.</done>
</task>

</tasks>

<verification>
- `npx vitest run src/generator/__fixtures__/fixture-snapshots.test.ts` — 30/30 pass
- `npx vitest run src/generator/__fixtures__/parity-diff.test.ts` — 9/9 pass
- `npx vitest run` — full suite green
- Git diff shows only .snap file changes (no test file or fixture-data changes)
</verification>

<success_criteria>
- All 30 fixture snapshots pass with updated baselines
- All 9 parity diff tests pass
- Full test suite passes
- Snapshot regeneration is a single atomic commit
- Chronic fixtures (txCount ≥ 16) show clinically plausible slower progression
</success_criteria>

<output>
After completion, create `.planning/phases/13-recovery-curve-goals-calibration/13-03-SUMMARY.md`
</output>
