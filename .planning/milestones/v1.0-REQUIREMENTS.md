# Requirements Archive: v1.0 Production Hardening

**Archived:** 2026-02-22
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements â€” v1.0 Production Hardening

## SEC-1: Excel Content Validation
Upload endpoint must verify file magic bytes (PK zip header), not just extension.

## SEC-2: CSRF Protection
State-changing endpoints (POST/PUT) must validate CSRF token via double-submit cookie pattern. Machine clients (x-api-key) exempt.

## SEC-3: Env Startup Validation
Production mode must fail fast if SHARED_JWT_SECRET or COOKIE_ENCRYPTION_KEY missing.

## BUG-1: Type-Safe Pain Parser
Replace `as any` in extractPainCurrent() with proper type guard. Log warnings on fallback.

## BUG-2: Auditor Optional Chaining
Fix undefined propagation in auditor layer1 (lines 55, 76, 97) with nullish coalescing defaults.
